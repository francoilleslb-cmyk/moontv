<!DOCTYPE html>
<html lang="es">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Moon TV â€” Panel de Canales</title>
<link href="https://fonts.googleapis.com/css2?family=Syne:wght@400;600;700;800&family=DM+Mono:wght@400;500&display=swap" rel="stylesheet">
<style>
/* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
   VARIABLES & RESET (Mantenemos tu estilo original)
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
:root {
  --bg: #080c10; --bg2: #0e1318; --bg3: #141b22; --border: #1e2a35; --border2: #263040;
  --accent: #00c2ff; --green: #00e676; --red: #ff4444; --yellow: #ffd600;
  --text: #e8f0f8; --text2: #7a9bb5; --text3: #3d5570; --radius: 10px;
  --font: 'Syne', sans-serif; --mono: 'DM Mono', monospace; --transition: .18s cubic-bezier(.4,0,.2,1);
}
*, *::before, *::after { box-sizing: border-box; margin: 0; padding: 0; }
body { font-family: var(--font); background: var(--bg); color: var(--text); display: flex; overflow-x: hidden; }

/* Sidebar y Layout */
.sidebar { width: 230px; min-height: 100vh; background: var(--bg2); border-right: 1px solid var(--border); position: fixed; display: flex; flex-direction: column; z-index: 100; }
.main { margin-left: 230px; flex: 1; display: flex; flex-direction: column; }

/* Topbar */
.topbar { display: flex; align-items: center; gap: 16px; padding: 18px 32px; border-bottom: 1px solid var(--border); background: var(--bg2); position: sticky; top: 0; z-index: 50; }
.btn { display: inline-flex; align-items: center; gap: 8px; padding: 9px 18px; border-radius: 8px; border: none; cursor: pointer; font-family: var(--font); font-weight: 700; transition: var(--transition); }
.btn-primary { background: var(--accent); color: var(--bg); }
.btn-danger { background: rgba(255,68,68,.15); color: var(--red); border: 1px solid rgba(255,68,68,.2); }
.btn-danger:hover { background: var(--red); color: white; }
.btn-ghost { background: var(--bg3); color: var(--text2); border: 1px solid var(--border2); }

/* Tabla y Checkboxes */
.table-wrapper { padding: 20px 32px; }
table { width: 100%; border-collapse: collapse; }
thead tr { background: var(--bg3); border-bottom: 1px solid var(--border); }
th, td { padding: 12px 16px; text-align: left; }
tbody tr { border-bottom: 1px solid var(--border); transition: var(--transition); }
tbody tr:hover { background: rgba(255,255,255,.02); }

/* Bulk Bar */
.bulk-bar { display: none; align-items: center; gap: 12px; background: rgba(255,214,0,.08); border: 1px solid rgba(255,214,0,.2); border-radius: 10px; padding: 10px 16px; margin: 16px 32px; color: var(--yellow); font-weight: 700; }

/* Login (Tu cÃ³digo original) */
#login-screen { position: fixed; inset: 0; background: var(--bg); z-index: 9999; display: flex; align-items: center; justify-content: center; }
.hidden { display: none !important; }
</style>
</head>
<body>

<div id="login-screen">
    <div class="login-card" style="background:var(--bg2); padding:40px; border-radius:18px; text-align:center;">
        <h1 style="margin-bottom:20px;">ğŸŒ™ Moon TV Admin</h1>
        <input type="password" id="login-key-input" placeholder="Clave de admin" style="padding:12px; border-radius:8px; border:1px solid var(--border2); background:var(--bg3); color:white; width:100%;">
        <button onclick="doLogin()" class="btn btn-primary" style="width:100%; margin-top:20px;">Ingresar</button>
    </div>
</div>

<aside class="sidebar">
    <div class="sidebar-logo" style="padding:28px;"><h1>ğŸŒ™ Moon TV</h1></div>
    <nav class="sidebar-nav" style="padding:16px;">
        <div onclick="setView('channels')" class="nav-item">ğŸ“º Canales</div>
        <div onclick="setView('movies')" class="nav-item">ğŸ¬ PelÃ­culas</div>
        <div onclick="setView('series')" class="nav-item">ğŸ­ Series</div>
        <hr style="border:0; border-top:1px solid var(--border); margin:10px 0;">
        <div onclick="doLogout()" style="color:var(--red); cursor:pointer; padding:10px;">ğŸšª Salir</div>
    </nav>
</aside>

<main class="main">
    <div class="topbar">
        <h2 id="view-title">ğŸ“º Canales</h2>
        <div style="flex:1"></div>
        <button class="btn btn-ghost" onclick="reloadCurrentView()">â†» Recargar</button>
        <button class="btn btn-primary" id="btn-new" onclick="openNew()">+ Nuevo</button>
        <button class="btn btn-danger" id="btn-delete-all" onclick="deleteAllContent()" style="display:none;">ğŸ—‘ï¸ Borrar Todo</button>
    </div>

    <div id="bulk-bar" class="bulk-bar">
        <span id="bulk-count">0 seleccionados</span>
        <button class="btn btn-danger" onclick="deleteSelected()">ğŸ—‘ï¸ Eliminar seleccionados</button>
        <button class="btn btn-ghost" onclick="clearSelection()">âœ• Cancelar</button>
    </div>

    <div class="table-wrapper">
        <table id="main-table">
            <thead>
                <tr>
                    <th style="width:36px"><input type="checkbox" id="select-all" onchange="toggleSelectAll(this)"></th>
                    <th>TÃ­tulo</th>
                    <th>CategorÃ­a</th>
                    <th>Acciones</th>
                </tr>
            </thead>
            <tbody id="table-body">
                </tbody>
        </table>
    </div>
</main>
<script>
let currentView = 'channels';
let adminKey = localStorage.getItem('admin_key') || '';

// Manejo de Vistas
function setView(view) {
    currentView = view;
    const title = document.getElementById('view-title');
    const btnDeleteAll = document.getElementById('btn-delete-all');
    
    // Actualizar Interfaz segÃºn pestaÃ±a
    if(view === 'channels') {
        title.innerText = "ğŸ“º Canales";
        btnDeleteAll.style.display = 'none';
    } else if(view === 'movies') {
        title.innerText = "ğŸ¬ PelÃ­culas";
        btnDeleteAll.style.display = 'inline-flex';
    } else if(view === 'series') {
        title.innerText = "ğŸ­ Series";
        btnDeleteAll.style.display = 'inline-flex';
    }
    loadData();
}

// FunciÃ³n BORRAR TODO (Modificada)
async function deleteAllContent() {
    if (!confirm(`âš ï¸ Â¡ALERTA! Â¿Seguro que quieres borrar TODAS las ${currentView}?`)) return;
    
    try {
        const res = await fetch(`/api/${currentView}/all`, {
            method: 'DELETE',
            headers: { 'Authorization': adminKey }
        });
        if(res.ok) {
            alert("Vaciado con Ã©xito");
            loadData();
        } else {
            alert("Error: No autorizado");
        }
    } catch (e) { console.error(e); }
}

// FunciÃ³n BORRAR SELECCIONADOS (Modificada)
async function deleteSelected() {
    const checked = document.querySelectorAll('tbody input[type="checkbox"]:checked');
    const ids = Array.from(checked).map(c => c.value);
    
    if(!confirm(`Â¿Borrar ${ids.length} elementos?`)) return;

    try {
        const res = await fetch(`/api/${currentView}/bulk-delete`, {
            method: 'POST',
            headers: { 
                'Content-Type': 'application/json',
                'Authorization': adminKey 
            },
            body: JSON.stringify({ ids })
        });
        if(res.ok) {
            clearSelection();
            loadData();
        }
    } catch (e) { console.error(e); }
}

// LÃ³gica de SelecciÃ³n
function toggleSelectAll(master) {
    const boxes = document.querySelectorAll('tbody input[type="checkbox"]');
    boxes.forEach(b => b.checked = master.checked);
    updateBulkBar();
}

function updateBulkBar() {
    const checked = document.querySelectorAll('tbody input[type="checkbox"]:checked').length;
    const bar = document.getElementById('bulk-bar');
    const count = document.getElementById('bulk-count');
    if(checked > 0) {
        bar.style.display = 'flex';
        count.innerText = `${checked} seleccionados`;
    } else {
        bar.style.display = 'none';
    }
}

function clearSelection() {
    document.getElementById('select-all').checked = false;
    document.getElementById('bulk-bar').style.display = 'none';
}

// Funciones de Login/Simuladas
function doLogin() {
    const key = document.getElementById('login-key-input').value;
    if(key) {
        adminKey = key;
        localStorage.setItem('admin_key', key);
        document.getElementById('login-screen').classList.add('hidden');
    }
}

function doLogout() {
    localStorage.removeItem('admin_key');
    location.reload();
}

// Carga de datos (Esquema general)
async function loadData() {
    const tbody = document.getElementById('table-body');
    tbody.innerHTML = '<tr><td colspan="4">Cargando...</td></tr>';
    
    try {
        const res = await fetch(`/api/${currentView}`);
        const data = await res.json();
        
        tbody.innerHTML = '';
        data.forEach(item => {
            const row = `<tr>
                <td><input type="checkbox" value="${item._id}" onchange="updateBulkBar()"></td>
                <td>${item.title}</td>
                <td>${item.category || 'N/A'}</td>
                <td><button onclick="deleteSingle('${item._id}')">ğŸ—‘ï¸</button></td>
            </tr>`;
            tbody.insertAdjacentHTML('beforeend', row);
        });
    } catch (e) {
        tbody.innerHTML = '<tr><td colspan="4">Error al cargar datos</td></tr>';
    }
}

window.onload = () => {
    if(adminKey) document.getElementById('login-screen').classList.add('hidden');
    setView('channels');
};
</script>
</body>
</html>
